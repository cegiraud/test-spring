# Initiatives microservices backend

Backend du project **Initiatives** basé sur une architecture microservices.

## Présentation des différents micro-services applicatifs

### auth-service 
L'auth-service est un serveur d'autorisation. Il ne gère que la correspondance entre l'utilisateur et ses rôles.
Un endpoint est fourni afin de permettre l'authentification (voir swagger). Il prend en paramètre d'appel un token linkedin.
Celui-ci n'est utilisé que pour s'assurer que l'utilisateur est bien authentifié sur linkedIn. 
Cette vérification est effectuée via l'appel de l'url (api linkedIn) du profil de l'utilisateur. 
Cela permet de réccupérer son :
 - id
 - prénom
 - nom
 
### user-service 
Le user-service gère l'utilisateur fonctionnellement. Il expose une api REST pour cette resource.
Il est appelé également par l'auth-service pour :
 - demander l'ajout de l'adresse mail à l'utilisateur courant
 - demander la validation du code reçu par mail
 
## Séquence d'activation du compte

![diag-first-connexion](https://www.websequencediagrams.com/cgi-bin/cdraw?lz=dGl0bGUgUHJlbWnDqHJlIGNvbm5leGlvbgpwYXJ0aWNpcGFudCBNb2JpbGUABg1hdXRoLXNlcnZpYwALDnVzZXIABBVTU08gcHJvdmlkZXIgKExpbmtlZEluKQoKCgBZBiAtPgAMGDoAagVlbnRpZmljYXRpb24gCgA4Fy0-AIEnBzogcsOpY2N1cMOpcgAtBmQndW4gYWNjZXNzVG9rZW4AbQwAgUMMOiBkZW1hbmRlIGQnAGgQCgCBbAwAgRQecHBlbCB1cmwgZHUgcHJvZmlsAIEcGQBwEgCBKxFlIGwnaWQsIHByw6lub20gZXQgbm9tAH4RACYgcyBoYWJpbGl0AIJBBXMgZW4gYmFzZQpub3RlIG92ZXIAgXwOCkNvbnN0aXR1AII3CnRva2VuIG91YXRoMiBhdmVjIAogICAtIACDdAVuYW1lAAgHZmlyc3ROAAYKbGEAAg1hdXRob3JpdGllcwplbmQgbm90ZQCCTBEAg0IIAG0HYXV0aDIKAIEhCwCEMgcKICAgIFBhcyBkZSByw7RsZQBICgCEUQsAhQ0MAIMXCGR1IGVuZHBvaW50IHBvdXIgc2F2b2lyIHNpIGxlIG1haWwgZXN0IGTDqWrDoCByZW5zZWlnbsOpCgCFWgwAgR8LCgoKb3B0IFNpIGwndXRpbGlzYXRldXIgbidhIHBhcyBlbmNvcmUgc2Fpc2kgc29uAF4FAIE6BQCBRRA6IGFmZmljaGFnZQCDdwbDqWNyYQCEBAUAOQVlIGR1ADQKAIE8KgAqFgCBPxAAgh4OZ8OpbgCGOA5jb2RlIGV0IGVudm9pIGRlIGNlbHVpLWNpIHBhcgA9GgCCHghlbmQgICAAgzgSAIFQJWNvZGUAhyEZAIFcFQCHRwh2YWxpZACIBQcAQQcAiTsMLT4AhBUOZGVsZWcAiGgGYXUAiUoOAIlZDAAnEABTEwAhDgCGVA4AdA4AgT8Pam91dCBkdQCFUAYgIlVTRVIiIMOgAIRPD2NvdXJhbnQAgT4PAIl_CAoK&s=napkin)
<!-- https://www.websequencediagrams.com/?lz=dGl0bGUgUHJlbWnDqHJlIGNvbm5leGlvbgpwYXJ0aWNpcGFudCBNb2JpbGUABg1hdXRoLXNlcnZpYwALDnVzZXIABBVTU08gcHJvdmlkZXIgKExpbmtlZEluKQoKCgBZBiAtPgAMGDoAagVlbnRpZmljYXRpb24gCgA4Fy0-AIEnBzogcsOpY2N1cMOpcgAtBmQndW4gYWNjZXNzVG9rZW4AbQwAgUMMOiBkZW1hbmRlIGQnAGgQCgCBbAwAgRQecHBlbCB1cmwgZHUgcHJvZmlsAIEcGQBwEgCBKxFlIGwnaWQsIHByw6lub20gZXQgbm9tAH4RACYgcyBoYWJpbGl0AIJBBXMgZW4gYmFzZQpub3RlIG92ZXIAgXwOCkNvbnN0aXR1AII3CnRva2VuIG91YXRoMiBhdmVjIAogICAtIACDdAVuYW1lAAgHZmlyc3ROAAYKbGEAAg1hdXRob3JpdGllcwplbmQgbm90ZQCCTBEAg0IIAG0HYXV0aDIKAIEhCwCEMgcKICAgIFBhcyBkZSByw7RsZQBICgCEUQsAhQ0MAIMXCGR1IGVuZHBvaW50IHBvdXIgc2F2b2lyIHNpIGxlIG1haWwgZXN0IGTDqWrDoCByZW5zZWlnbsOpCgCFWgwAgR8LCgoKb3B0IFNpIGwndXRpbGlzYXRldXIgbidhIHBhcyBlbmNvcmUgc2Fpc2kgc29uAF4FAIE6BQCBRRA6IGFmZmljaGFnZQCDdwbDqWNyYQCEBAUAOQVlIGR1ADQKAIE8KgAqFgCBPxAAgh4OZ8OpbgCGOA5jb2RlIGV0IGVudm9pIGRlIGNlbHVpLWNpIHBhcgA9GgCCHghlbmQgICAAgzgSAIFQJWNvZGUAhyEZAIFcFQCHRwh2YWxpZACIBQcAQQcAiTsMLT4AhBUOZGVsZWcAiGgGYXUAiUoOAIlZDAAnEABTEwAhDgCGVA4AdA4AgT8Pam91dCBkdQCFUAYgIlVTRVIiIMOgAIRPD2NvdXJhbnQAgT4PAIl_CAoK&s=napkin -->

Une fois la séquence d'activation effectuée, le mobile réeffectue le processus d'authentification.
Cette fois ci il s'agit du cas nominal. Le rôle "USER" qui a été ajouté est présent dans ce nouveau token.
 
## Cas norminal
![diag-normal-connexion](https://www.websequencediagrams.com/cgi-bin/cdraw?lz=dGl0bGUgQ29ubmV4aW9uIGNsYXNzaXF1ZQoKTW9iaWxlIC0-IFNTTyBwcm92aWRlciAoTGlua2VkSW4pOiBhdXRoZW50aWZpY2F0aW9uIAoAFBctPiAASQY6IHLDqWNjdXDDqXIALQZkJ3VuIGFjY2Vzc1Rva2VuAG0MYXV0aC1zZXJ2aWNlOiBkZW1hbmRlIGQnAGgQCgAdDACBFB5wcGVsIHVybCBkdSBwcm9maWwAgRwZAHASAIErEWUgbCdpZCwgcHLDqW5vbSBldCBub20AfhEAJiBzIGhhYmlsaXQAgkEFcyBlbiBiYXNlCm5vdGUgb3ZlcgCBfA4KQ29uc3RpdHUAgjcKdG9rZW4gb3VhdGgyIGF2ZWMgCiAgIC0gIHVzZXJuYW1lAAgHZmlyc3ROAAYKbGEAAg1hdXRob3JpdGllcwplbmQgbm90ZQCCTBEAg0IIAG0HYXV0aDIKCg&s=napkin)
<!-- https://www.websequencediagrams.com/?lz=dGl0bGUgQ29ubmV4aW9uIGNsYXNzaXF1ZQoKTW9iaWxlIC0-IFNTTyBwcm92aWRlciAoTGlua2VkSW4pOiBhdXRoZW50aWZpY2F0aW9uIAoAFBctPiAASQY6IHLDqWNjdXDDqXIALQZkJ3VuIGFjY2Vzc1Rva2VuAG0MYXV0aC1zZXJ2aWNlOiBkZW1hbmRlIGQnAGgQCgAdDACBFB5wcGVsIHVybCBkdSBwcm9maWwAgRwZAHASAIErEWUgbCdpZCwgcHLDqW5vbSBldCBub20AfhEAJiBzIGhhYmlsaXQAgkEFcyBlbiBiYXNlCm5vdGUgb3ZlcgCBfA4KQ29uc3RpdHUAgjcKdG9rZW4gb3VhdGgyIGF2ZWMgCiAgIC0gIHVzZXJuYW1lAAgHZmlyc3ROAAYKbGEAAg1hdXRob3JpdGllcwplbmQgbm90ZQCCTBEAg0IIAG0HYXV0aDIKCg&s=napkin -->
